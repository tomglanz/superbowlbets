<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Bowl Prop 2026 - Live Scoreboard</title>
    <link rel="icon" href="https://static.www.nfl.com/image/upload/v1554321393/league/api/clubs/logos/SEA.svg">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #002244 0%, #69BE28 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        /* Leaderboard */
        .leaderboard {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .leaderboard h2 {
            color: #002244;
            margin-bottom: 20px;
            font-size: 2em;
            border-bottom: 3px solid #69BE28;
            padding-bottom: 10px;
        }

        .podium {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 20px;
            margin-bottom: 30px;
            min-height: 200px;
        }

        .podium-place {
            text-align: center;
            background: linear-gradient(145deg, #f0f0f0, #ffffff);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            position: relative;
            min-width: 150px;
        }

        .podium-place.first {
            order: 2;
            height: 220px;
            background: linear-gradient(145deg, #FFD700, #FFA500);
        }

        .podium-place.second {
            order: 1;
            height: 180px;
            background: linear-gradient(145deg, #C0C0C0, #999999);
        }

        .podium-place.third {
            order: 3;
            height: 140px;
            background: linear-gradient(145deg, #CD7F32, #996633);
        }

        .podium-rank {
            font-size: 3em;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .podium-name {
            font-size: 1.3em;
            font-weight: bold;
            margin: 10px 0;
            color: #002244;
        }

        .podium-score {
            font-size: 1.8em;
            font-weight: bold;
            color: #69BE28;
        }

        .leaderboard-list {
            display: grid;
            gap: 10px;
        }

        .leaderboard-row {
            display: grid;
            grid-template-columns: 60px 1fr 100px;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .leaderboard-row:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .rank {
            font-size: 1.5em;
            font-weight: bold;
            color: #002244;
            text-align: center;
        }

        .player-name {
            font-size: 1.2em;
            font-weight: 500;
            color: #333;
        }

        .score {
            font-size: 1.4em;
            font-weight: bold;
            color: #69BE28;
            text-align: right;
        }

        /* Questions Grid */
        .questions-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .questions-section h2 {
            color: #002244;
            margin-bottom: 20px;
            font-size: 2em;
            border-bottom: 3px solid #69BE28;
            padding-bottom: 10px;
        }

        .question-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #002244;
        }

        .question-card.answered {
            border-left-color: #69BE28;
            background: #e8f5e9;
        }

        .question-text {
            font-size: 1.1em;
            font-weight: 500;
            margin-bottom: 10px;
            color: #002244;
        }

        .correct-answer {
            display: inline-block;
            background: #69BE28;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            font-weight: bold;
            margin-top: 5px;
        }

        /* Admin Panel */
        .admin-panel {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .admin-panel h2 {
            color: #002244;
            margin-bottom: 20px;
            font-size: 2em;
            border-bottom: 3px solid #69BE28;
            padding-bottom: 10px;
        }

        .admin-question {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .admin-question label {
            display: block;
            font-weight: 500;
            margin-bottom: 10px;
            color: #002244;
        }

        .admin-question input,
        .admin-question select {
            width: 100%;
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 5px;
            font-size: 1em;
        }

        .admin-question input:focus,
        .admin-question select:focus {
            outline: none;
            border-color: #69BE28;
        }

        button {
            background: #69BE28;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        button:hover {
            background: #5aa622;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(105, 190, 40, 0.3);
        }

        .login-form {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .login-form h2 {
            color: #002244;
            margin-bottom: 20px;
            text-align: center;
        }

        .login-form input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 2px solid #dee2e6;
            border-radius: 5px;
            font-size: 1em;
        }

        .error-message {
            background: #dc3545;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        .loading {
            text-align: center;
            color: white;
            font-size: 1.5em;
            padding: 50px;
        }

        .view-toggle {
            text-align: center;
            margin-bottom: 20px;
        }

        .view-toggle button {
            margin: 0 10px;
        }

        .last-updated {
            text-align: center;
            color: rgba(255,255,255,0.8);
            font-size: 0.9em;
            margin-top: 20px;
        }

        .no-data {
            text-align: center;
            padding: 50px;
            color: #666;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <script>
        // Configuration
        const CONFIG = {
            SHEET_ID: '1Y7aOaQ3Y4-zKIiBrbIud8f1xcZp80A5toRmpc7Yg5Yc',
            ADMIN_PASSWORD: 'GoHawks26',
            REFRESH_INTERVAL: 30000, // 30 seconds
            FIREBASE_CONFIG: {
                apiKey: "AIzaSyBDOEaFUeSfe0FRrdjKET-C1y04N6NzvUU",
                authDomain: "superbowl-bets-7e99d.firebaseapp.com",
                databaseURL: "https://superbowl-bets-7e99d-default-rtdb.firebaseio.com",
                projectId: "superbowl-bets-7e99d",
                storageBucket: "superbowl-bets-7e99d.firebasestorage.app",
                messagingSenderId: "29397784871",
                appId: "1:29397784871:web:2161c1f3f6008d6f29f102"
            }
        };

        // Initialize Firebase
        let db = null;
        try {
            firebase.initializeApp(CONFIG.FIREBASE_CONFIG);
            db = firebase.database();
            console.log('Firebase initialized');
        } catch (error) {
            console.warn('Firebase not configured, using localStorage fallback');
        }

        // State
        let currentView = 'scoreboard'; // 'scoreboard' or 'admin'
        let participants = [];
        let correctAnswers = {};
        let questions = [];
        let isAdmin = false;

        // Get correct answers from Firebase or localStorage
        async function getCorrectAnswers() {
            if (db) {
                try {
                    const snapshot = await db.ref('correctAnswers').once('value');
                    return snapshot.val() || {};
                } catch (error) {
                    console.error('Firebase read error:', error);
                    return JSON.parse(localStorage.getItem('correctAnswers') || '{}');
                }
            }
            return JSON.parse(localStorage.getItem('correctAnswers') || '{}');
        }

        // Save correct answers to Firebase and localStorage
        async function saveCorrectAnswers(answers) {
            correctAnswers = answers;
            localStorage.setItem('correctAnswers', JSON.stringify(answers));
            
            if (db) {
                try {
                    await db.ref('correctAnswers').set(answers);
                } catch (error) {
                    console.error('Firebase write error:', error);
                }
            }
        }

        // Fetch data from Google Sheets
        async function fetchSheetData() {
            try {
                // Use the published CSV URL
                const url = `https://docs.google.com/spreadsheets/d/e/2PACX-1vTlM_j6A0tYKmexDB-eCJ1LiiodtzbRkw3FMnxuXE5CgKUdJXQRZca1C4zWO54IL6Ltq16Me_8h5fU-/pub?output=csv`;
                console.log('Fetching from:', url);
                
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const csvText = await response.text();
                console.log('CSV response received, length:', csvText.length);
                
                // Parse CSV
                const rows = csvText.split('\n').map(row => {
                    // Simple CSV parsing - handle quoted fields
                    const cells = [];
                    let current = '';
                    let inQuotes = false;
                    
                    for (let i = 0; i < row.length; i++) {
                        const char = row[i];
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            cells.push(current.trim());
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    cells.push(current.trim());
                    return cells;
                });
                
                console.log('CSV rows parsed:', rows.length);
                
                if (rows.length === 0) {
                    return { participants: [], questions: [] };
                }

                // Extract headers (questions) from first row
                const headers = rows[0];
                console.log('Headers:', headers);
                
                // Questions start from column 4 (index 3) - skipping Timestamp, Score, Payment, Name
                const questionColumns = headers.slice(4).filter(h => h);
                questions = questionColumns.map((q, index) => ({
                    id: index,
                    text: q,
                    column: index + 4
                }));
                
                console.log('Questions parsed:', questions.length);

                // Extract participant data
                participants = [];
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i];
                    if (!row || row.length < 4 || !row[3]) continue; // Skip if no name
                    
                    const participant = {
                        name: row[3],
                        answers: {},
                        score: 0
                    };

                    // Get answers for each question
                    questions.forEach(q => {
                        participant.answers[q.id] = row[q.column] || '';
                    });

                    participants.push(participant);
                }
                
                console.log('Participants parsed:', participants.length);

                return { participants, questions };
            } catch (error) {
                console.error('Error fetching sheet data:', error);
                console.error('Error details:', error.message, error.stack);
                return { participants: [], questions: [] };
            }
        }

        // Calculate scores
        function calculateScores() {
            participants.forEach(p => {
                let score = 0;
                questions.forEach(q => {
                    const userAnswer = p.answers[q.id];
                    const correctAnswer = correctAnswers[q.id];
                    
                    if (correctAnswer && userAnswer === correctAnswer) {
                        score++;
                    }
                });
                p.score = score;
            });

            // Sort by score descending
            participants.sort((a, b) => b.score - a.score);
        }

        // Render scoreboard view
        function renderScoreboard() {
            calculateScores();

            const topThree = participants.slice(0, 3);
            const rest = participants.slice(3);

            let podiumHTML = '';
            if (topThree.length >= 1) {
                podiumHTML = `
                    <div class="podium">
                        ${topThree.length >= 2 ? `
                            <div class="podium-place second">
                                <div class="podium-rank">2</div>
                                <div class="podium-name">${topThree[1].name}</div>
                                <div class="podium-score">${topThree[1].score}</div>
                            </div>
                        ` : ''}
                        <div class="podium-place first">
                            <div class="podium-rank">1</div>
                            <div class="podium-name">${topThree[0].name}</div>
                            <div class="podium-score">${topThree[0].score}</div>
                        </div>
                        ${topThree.length >= 3 ? `
                            <div class="podium-place third">
                                <div class="podium-rank">3</div>
                                <div class="podium-name">${topThree[2].name}</div>
                                <div class="podium-score">${topThree[2].score}</div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            const restHTML = rest.map((p, index) => `
                <div class="leaderboard-row">
                    <div class="rank">${index + 4}</div>
                    <div class="player-name">${p.name}</div>
                    <div class="score">${p.score}</div>
                </div>
            `).join('');

            const questionsHTML = questions.map(q => {
                const hasAnswer = correctAnswers[q.id];
                return `
                    <div class="question-card ${hasAnswer ? 'answered' : ''}">
                        <div class="question-text">${q.text}</div>
                        ${hasAnswer ? `<div class="correct-answer">‚úì ${correctAnswers[q.id]}</div>` : ''}
                    </div>
                `;
            }).join('');

            return `
                <div class="container">
                    <header>
                        <h1>üèà Super Bowl LX Prop Bet 2026 üèà</h1>
                        <div class="subtitle">Live Scoreboard</div>
                    </header>

                    ${isAdmin ? `
                        <div class="view-toggle">
                            <button onclick="switchView('scoreboard')">Scoreboard View</button>
                            <button onclick="switchView('admin')">Admin Panel</button>
                        </div>
                    ` : ''}

                    <div class="leaderboard">
                        <h2>üèÜ Leaderboard</h2>
                        ${participants.length > 0 ? `
                            ${podiumHTML}
                            <div class="leaderboard-list">
                                ${restHTML}
                            </div>
                        ` : '<div class="no-data">No entries yet. Waiting for participants...</div>'}
                    </div>

                    <div class="questions-section">
                        <h2>üìã Questions & Answers</h2>
                        ${questions.length > 0 ? questionsHTML : '<div class="no-data">Loading questions...</div>'}
                    </div>

                    <div class="last-updated">
                        Last updated: ${new Date().toLocaleTimeString()}
                        <br>Auto-refreshing every 30 seconds
                    </div>
                </div>
            `;
        }

        // Render admin panel
        function renderAdminPanel() {
            const questionsHTML = questions.map(q => `
                <div class="admin-question">
                    <label>${q.text}</label>
                    <input 
                        type="text" 
                        id="answer-${q.id}"
                        value="${correctAnswers[q.id] || ''}"
                        placeholder="Enter correct answer"
                    />
                </div>
            `).join('');

            return `
                <div class="container">
                    <header>
                        <h1>üèà Super Bowl LX Admin Panel üèà</h1>
                        <div class="subtitle">Set Correct Answers</div>
                    </header>

                    <div class="view-toggle">
                        <button onclick="switchView('scoreboard')">Scoreboard View</button>
                        <button onclick="switchView('admin')">Admin Panel</button>
                    </div>

                    <div class="admin-panel">
                        <h2>‚öôÔ∏è Set Correct Answers</h2>
                        ${questionsHTML}
                        <button onclick="saveAnswers()" style="margin-top: 20px; width: 100%;">
                            üíæ Save Answers
                        </button>
                    </div>
                </div>
            `;
        }

        // Render login form
        function renderLogin() {
            return `
                <div class="login-form">
                    <h2>üîí Admin Login</h2>
                    <input 
                        type="password" 
                        id="admin-password"
                        placeholder="Enter admin password"
                        onkeypress="if(event.key === 'Enter') checkPassword()"
                    />
                    <button onclick="checkPassword()" style="width: 100%;">Login</button>
                </div>
            `;
        }

        // Check admin password
        async function checkPassword() {
            const input = document.getElementById('admin-password');
            const password = input ? input.value : '';
            
            console.log('Checking password...');
            
            if (password === CONFIG.ADMIN_PASSWORD) {
                console.log('Password correct, loading data...');
                isAdmin = true;
                
                // Show loading message
                document.getElementById('app').innerHTML = '<div class="loading">Loading admin panel...</div>';
                
                try {
                    await loadData();
                    console.log('Data loaded, rendering...');
                    render();
                } catch (error) {
                    console.error('Error loading data:', error);
                    document.getElementById('app').innerHTML = `
                        <div class="error-message">
                            Error loading data: ${error.message}
                            <br><br>
                            <button onclick="location.reload()">Retry</button>
                        </div>
                    `;
                }
            } else {
                console.log('Password incorrect');
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-message';
                errorDiv.textContent = 'Incorrect password';
                errorDiv.style.marginTop = '10px';
                
                const form = document.querySelector('.login-form');
                const existingError = form.querySelector('.error-message');
                if (existingError) {
                    existingError.remove();
                }
                form.insertBefore(errorDiv, form.querySelector('button'));
            }
        }

        // Save answers from admin panel
        async function saveAnswers() {
            const newAnswers = {};
            questions.forEach(q => {
                const input = document.getElementById(`answer-${q.id}`);
                if (input && input.value.trim()) {
                    newAnswers[q.id] = input.value.trim();
                }
            });
            
            await saveCorrectAnswers(newAnswers);
            alert('Answers saved!');
            switchView('scoreboard');
        }

        // Switch between views
        function switchView(view) {
            currentView = view;
            render();
        }

        // Load all data
        async function loadData() {
            try {
                console.log('Loading data...');
                const data = await fetchSheetData();
                participants = data.participants;
                questions = data.questions;
                correctAnswers = await getCorrectAnswers();
                console.log('Data loaded successfully:', {
                    participants: participants.length,
                    questions: questions.length,
                    correctAnswers: Object.keys(correctAnswers).length
                });
            } catch (error) {
                console.error('Error loading data:', error);
                throw error;
            }
        }

        // Render current view
        function render() {
            const app = document.getElementById('app');
            
            try {
                console.log('Rendering view:', currentView);
                console.log('Data state:', { 
                    participants: participants.length, 
                    questions: questions.length 
                });
                
                if (currentView === 'admin') {
                    app.innerHTML = renderAdminPanel();
                } else {
                    app.innerHTML = renderScoreboard();
                }
            } catch (error) {
                console.error('Render error:', error);
                app.innerHTML = `
                    <div class="error-message">
                        Error rendering page: ${error.message}
                        <br><br>
                        <button onclick="location.reload()">Reload Page</button>
                    </div>
                `;
            }
        }

        // Initialize app
        async function init() {
            try {
                console.log('Initializing app...');
                
                // Check URL for admin mode
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.get('admin') === 'true') {
                    console.log('Admin mode detected');
                    document.getElementById('app').innerHTML = renderLogin();
                    return;
                }

                console.log('Loading initial data...');
                await loadData();
                console.log('Initial data loaded, rendering...');
                render();

                // Auto-refresh every 30 seconds
                setInterval(async () => {
                    if (currentView === 'scoreboard') {
                        console.log('Auto-refreshing data...');
                        await loadData();
                        render();
                    }
                }, CONFIG.REFRESH_INTERVAL);
                
                console.log('App initialized successfully');
            } catch (error) {
                console.error('Initialization error:', error);
                document.getElementById('app').innerHTML = `
                    <div class="container">
                        <div class="error-message">
                            <h2>Error Loading App</h2>
                            <p>${error.message}</p>
                            <p>Please check the browser console for details.</p>
                            <button onclick="location.reload()">Retry</button>
                        </div>
                    </div>
                `;
            }
        }

        // Start the app
        init();
    </script>
</body>
</html>
